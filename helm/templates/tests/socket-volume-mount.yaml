apiVersion: v1
kind: Pod
metadata:
  name: "socket-volume-mount"
  annotations:
    "helm.sh/hook": test
spec:
  serviceAccountName: {{ .Values.serviceAccount.name }}
  restartPolicy: Never
  volumes:
{{/*    - name: socket-file-volume*/}}
{{/*      hostPath:*/}}
{{/*        path: {{ .Values.socket.path }}*/}}
{{/*        type: Directory*/}}
  containers:
    - name: kubectl-etcd
      image: "docker.io/ruddickmg/kubectl-etcd:latest"
      imagePullPolicy: "IfNotPresent"
{{/*      volumeMounts:*/}}
{{/*        - mountPath: {{ .Values.socket.path }}*/}}
{{/*          name: socket-file-volume*/}}
{{/*          readOnly: true*/}}
      command:
        - /bin/sh
        - -c
        - >
          echo "starting";
          export SOCKET_FILE_PATH={{ .Values.socket.path }}/{{ .Values.socket.name }};
          echo "file path: $FILE_PATH";
          [ -f $FILE_PATH ] && exit 0 || exit 1;