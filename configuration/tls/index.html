<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Vault KMS Provider</title>
        <link rel="stylesheet" href="/css/index.css">
        <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
        <link rel="icon" href="/assets/favicon.ico">
        <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
        <link rel="manifest" href="/assets/site.webmanifest">
        <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
        <link href="https://unpkg.com/prismjs@1.20.0/themes/prism-solarizedlight.css" rel="stylesheet"/>
    </head>
    <body style="background-color: #ffffff">
        <div class = "github-link">
            <a href="https://github.com/Ruddickmg/vault-kms-provider">
                <img src="/assets/github-mark.png" alt="GitHub" class="github-icon" />
            </a>
        </div>
        
<div class="homepage">
    <div class="sidebar">
       <div class="navbar">
           <div>
             <a href="/">
               <h2>About</h2>
             </a>
           </div>
           <div>
             <a href="/quick-start">
               <h2>Quick Start</h2>
             </a>
           </div>
           
               
                   
               
           
               
                   
               
           
               
                   
               
           
               
                   
               
           
               
                   
                   <div>
                     
                       <a href="/configuration"><h2>Configuration</h2></a>
                     
                     <ul>
                       
                         <li><a href=/configuration/authentication/>Authentication</a></li>
                       
                         <li><a href=/configuration/kubernetes/>Kubernetes</a></li>
                       
                         <li><a href=/configuration/provider/>Provider</a></li>
                       
                         <li><a href=/configuration/tls/>Tls</a></li>
                       
                         <li><a href=/configuration/vault/>Vault</a></li>
                       
                     </ul>
                   </div>
                   
               
           
               
                   
               
           
               
                   
                   <div>
                     
                       <a href="/installation"><h2>Installation</h2></a>
                     
                     <ul>
                       
                         <li><a href=/installation/docker/>Docker</a></li>
                       
                         <li><a href=/installation/helm/>Helm</a></li>
                       
                         <li><a href=/installation/repository/>Repository</a></li>
                       
                         <li><a href=/installation/static/>Static</a></li>
                       
                     </ul>
                   </div>
                   
               
           
               
                   
                   <div>
                     
                       <h2>Benchmarks</h2>
                     
                     <ul>
                       
                         <li><a href=/benchmarks/decryption/>Decryption</a></li>
                       
                         <li><a href=/benchmarks/encryption/>Encryption</a></li>
                       
                         <li><a href=/benchmarks/health/>Health</a></li>
                       
                     </ul>
                   </div>
                   
               
           
       </div>
    </div>
    <div class="content">
        
<div class="content-header">
    <h1>Configuration</h1>
</div>
<div class="content-body">
    <h2>Set up TLS communication</h2>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p>Documentation on TLS configuration for vault can be <a href="https://developer.hashicorp.com/vault/docs/configuration/listener/tcp">found on their website</a></p>
</div>
<h3>Add Vault's CA file(s) to the KMS provider</h3>
<p>To allow TLS encrypted communication with vault, Vault's CA (certificate authority) file(s) need to be installed in the KMS provider. This can be set in the values.yaml for the helm chart.</p>
<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">vault</span><span class="token punctuation">:</span>
  <span class="token key atrule">ca</span><span class="token punctuation">:</span>
    <span class="token comment"># full path to a specific CA file</span>
    <span class="token key atrule">file</span><span class="token punctuation">:</span> <span class="token string">"/path/to/ca.crt"</span>
    <span class="token comment"># full path to a directory containing CA file(s)</span>
    <span class="token key atrule">directory</span><span class="token punctuation">:</span> <span class="token string">"/path/to/ca/directory"</span></code></pre>
<p>If you have a single CA file for vault, you can set a specific path to it.</p>
<pre class="language-shell"><code class="language-shell">helm <span class="token function">install</span> vault-kms-provider <span class="token parameter variable">--set</span> <span class="token string">"vault.ca.file=/path/to/ca.crt"</span></code></pre>
<p>If you have more than one file, or would rather just point to a directory, you can also specify a directory path. All certificates in the directory path will be installed in the KMS provider.</p>
<pre class="language-shell"><code class="language-shell">helm <span class="token function">install</span> vault-kms-provider <span class="token parameter variable">--set</span> <span class="token string">"vault.ca.directory=/path/to/directory"</span></code></pre>
<h3>Mount Vault's CA files into the KMS provider</h3>
<p>In order for Vault's CA files to be installed, they must be present in the container, we can mount the CA file(s) by defining volumes and volumeMounts in our values.yaml.</p>
<p>The following are examples of how to mount Vault CA file(s) into the KMS provider.</p>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p>A full list of <a href="https://kubernetes.io/docs/concepts/storage/volumes/">mount options and documentation</a> can be found on the Kubernetes website. Chose what works best for your use case.</p>
</div>
<h4>Secrets</h4>
<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token comment"># name of the volume, should match the volumeMount name</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> vault<span class="token punctuation">-</span>ca<span class="token punctuation">-</span>certificate
    <span class="token key atrule">secret</span><span class="token punctuation">:</span>
      <span class="token comment"># The name of the secret that contains the Vault CA certificate(s)</span>
      <span class="token key atrule">secretName</span><span class="token punctuation">:</span> vault<span class="token punctuation">-</span>ca<span class="token punctuation">-</span>certs

<span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
  <span class="token comment"># Match with volume name</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> vault<span class="token punctuation">-</span>ca<span class="token punctuation">-</span>certificate
    <span class="token comment"># path where the files will be in the KMS provider</span>
    <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/ssl/certs</code></pre>
<h4>Volumes</h4>
<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token comment"># name of the volume, should match the volumeMount name</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> vault<span class="token punctuation">-</span>ca<span class="token punctuation">-</span>certificates
    <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
      <span class="token comment"># Path to the directory where the Vault CA certificate(s) are located on the host machine</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /path/to/host/certificates
      <span class="token key atrule">type</span><span class="token punctuation">:</span> Directory

<span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
  <span class="token comment"># Match with volume name</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> vault<span class="token punctuation">-</span>ca<span class="token punctuation">-</span>certificate
    <span class="token comment"># path where the files will be in the KMS provider</span>
    <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/ssl/certs</code></pre>

</div>

    </div>
</div>
    </body>
</html>
